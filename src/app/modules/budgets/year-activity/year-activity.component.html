<p-toast key="YearActivity" position="bottom-left"></p-toast>

<div class="d-flex justify-content-between">
  <div class="table-header">برنامه عملیاتی</div>
  <div>
    <p-button
      class="pe-2 mr-8"
      styleClass="p-button-info"
      icon="pi pi-plus-circle"
      label="افزودن"
      (click)="addYearActivity()"></p-button>
  </div>
</div>

<div class="panel-search mt-8 mb-8">
  <form #formDir="ngForm" [formGroup]="searchForm">
    <div class="row mt-8 pb-3">
      <div class="col-2">
        <label for="budgetPeriodId"> دوره </label>
        <p-dropdown
          id="budgetPeriodId"
          name="budgetPeriodId"
          formControlName="budgetPeriodId"
          styleClass="w-100 my-1"
          optionLabel="periodTitle"
          optionValue="id"
          placeholder="انتخاب کنید"
          [options]="budgetPeriodList"
          [filter]="true"
          [readonly]="true">
        </p-dropdown>
      </div>
      <div class="col-2">
        <label for="yearGoalId"> هدف سالیانه </label>
        <p-dropdown
          id="yearGoalId"
          name="yearGoalId"
          formControlName="yearGoalId"
          styleClass="w-100 my-1"
          [readonly]="true"
          optionLabel="title"
          optionValue="id"
          placeholder="انتخاب کنید"
          [options]="yearGoalList"
          [filter]="true">
        </p-dropdown>
      </div>
      <!--  دوره عملیاتی -->
      <div class="col-2">
        <label for="fromPeriodDetailId"> از دوره عملیاتی </label>
        <p-dropdown
          id="fromPeriodDetailId"
          name="fromPeriodDetailId"
          formControlName="fromPeriodDetailId"
          styleClass="w-100 my-1"
          optionLabel="periodDetailTitle"
          optionValue="id"
          placeholder="انتخاب کنید"
          [options]="periodDetailList"
          [filter]="true">
        </p-dropdown>
      </div>
      <div class="col-2">
        <label for="toPeriodDetailId">تا دوره عملیاتی </label>
        <p-dropdown
          id="toPeriodDetailId"
          name="toPeriodDetailId"
          formControlName="toPeriodDetailId"
          styleClass="w-100 my-1"
          optionLabel="periodDetailTitle"
          optionValue="id"
          placeholder="انتخاب کنید"
          [options]="periodDetailList"
          [filter]="true">
        </p-dropdown>
      </div>
      <!--  دوره عملیاتی -->

      <div class="col-2">
        <label for="rollId"> مسئول</label>
        <p-dropdown
          id="rollId"
          name="rollId"
          formControlName="rollId"
          styleClass="w-100 my-1"
          optionLabel="title"
          optionValue="id"
          placeholder="انتخاب کنید"
          [options]="rollList"
          [filter]="true">
        </p-dropdown>
      </div>
      <div class="col-2">
        <label for="operatingId"> شناسه طرح</label>
        <p-dropdown
          id="operatingId"
          name="operatingId"
          formControlName="operatingId"
          styleClass="w-100 my-1"
          optionLabel="title"
          optionValue="id"
          placeholder="انتخاب کنید"
          [options]="operationList"
          [filter]="true">
        </p-dropdown>
      </div>
      <div class="col-2">
        <label for="weightCode"> وزن</label>
        <p-dropdown
          id="weightCode"
          name="weightCode"
          formControlName="weightCode"
          styleClass="w-100 my-1"
          optionLabel="title"
          optionValue="id"
          placeholder="انتخاب کنید"
          [options]="weightCodeList"
          [filter]="true">
        </p-dropdown>
      </div>
      <div class="col-2">
        <label for="priorityCode"> اولویت</label>
        <p-dropdown
          id="priorityCode"
          name="priorityCode"
          formControlName="priorityCode"
          styleClass="w-100 my-1"
          optionLabel="title"
          optionValue="id"
          placeholder="انتخاب کنید"
          [options]="priorityCodeList"
          [filter]="true">
        </p-dropdown>
      </div>

      <div class="col-2">
        <label for="code"> کد </label>
        <input
          pInputText
          id="code"
          name="code"
          formControlName="code"
          class="w-100 my-1" />
      </div>
      <div class="col-2">
        <label for="title"> عنوان </label>
        <input
          pInputText
          id="title"
          name="title"
          formControlName="title"
          class="w-100 my-1" />
      </div>
      <div class="col-2">
        <label for="description"> شرح </label>
        <input
          pInputText
          id="description"
          name="description"
          formControlName="description"
          class="w-100 my-1" />
      </div>
      <div class="col-2">
        <label for="priceCu"> تاثیر مالی </label>
        <p-inputNumber
          id="priceCu"
          formControlName="priceCu"
          type="text"
          pKeyFilter="int"
          [minlength]="0"
          class="w-100"></p-inputNumber>
      </div>

      <div class="col-2">
        <label for="costCenterId"> مرکز هزینه</label>
        <p-dropdown
          id="costCenterId"
          name="costCenterId"
          formControlName="costCenterId"
          styleClass="w-100 my-1"
          optionLabel="title"
          optionValue="id"
          placeholder="انتخاب کنید"
          [options]="costCenterList"
          [filter]="true">
        </p-dropdown>
      </div>

      <!-- دکمه -->
      <div
        class="d-flex justify-content-end col text-end"
        style="margin-top: 20px">
        <div class="search-button mt-12">
          <div class="clear-search" (click)="clearSearch()">
            <i class="pi pi-filter-slash"></i>
          </div>
          <p-button
            class="pe-2 p-button-wide"
            styleClass="p-button-info"
            [label]="'جستجو'"
            (click)="getList()"></p-button>
        </div>
      </div>
      <!-- / دکمه -->
    </div>
  </form>
</div>

<div class="table-container">
  <p-table
    #dataTable
    dataKey="id"
    class="data-table d-none d-lg-block"
    [styleClass]="gridClass"
    [rowHover]="true"
    [paginator]="true"
    [rows]="dataTableRows"
    [rowsPerPageOptions]="[10, 20, 30]"
    [totalRecords]="totalCount"
    [value]="data"
    [loading]="loading"
    [tableStyle]="{ 'min-width': '75rem' }"
    [lazy]="true"
    (onLazyLoad)="getList($event)"
    [(first)]="first">
    <!-- table header -->
    <ng-template pTemplate="header">
      <tr class="data-table__header">
        <th style="min-width: 10rem"><strong> کد</strong></th>
        <th style="min-width: 10rem"><strong> عنوان</strong></th>
        <th style="min-width: 10rem"><strong> از دوره عملیاتی </strong></th>
        <th style="min-width: 10rem"><strong> تا دوره عملیاتی </strong></th>
        <th style="min-width: 10rem"><strong> مرکز هزینه</strong></th>
        <th style="min-width: 10rem"><strong> مسئول</strong></th>
        <th style="min-width: 10rem"><strong> تاثیر مالی</strong></th>
        <th style="min-width: 10rem"><strong> الویت</strong></th>
        <th style="min-width: 10rem"><strong> وزن</strong></th>
        <th style="min-width: 10rem"><strong> شرح</strong></th>
        <th style="min-width: 10rem"><strong> وضعیت</strong></th>

        <th style="min-width: 10rem"><strong> عملیات</strong></th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-item item let-rowIndex="rowIndex">
      <tr>
        <td>{{ item.code }}</td>
        <td
          pTooltip="{{ item.title }}"
          tooltipEvent="hover"
          tooltipPosition="top">
          {{ item.title }}
        </td>
        <td
          pTooltip="{{ item.fromPeriodDetailTitle }}"
          tooltipEvent="hover"
          tooltipPosition="top">
          {{ item.fromPeriodDetailTitle }}
        </td>
        <td
          pTooltip="{{ item.toPeriodDetailTitle }}"
          tooltipEvent="hover"
          tooltipPosition="top">
          {{ item.toPeriodDetailTitle }}
        </td>
        <td
          pTooltip="{{ item.costCenterTitle }}"
          tooltipEvent="hover"
          tooltipPosition="top">
          {{ item.costCenterTitle }}
        </td>
        <td
          pTooltip="{{ item.rollTitle }}"
          tooltipEvent="hover"
          tooltipPosition="top">
          {{ item.rollTitle }}
        </td>
        <td
          pTooltip="{{ item.priceCu }}"
          tooltipEvent="hover"
          tooltipPosition="top">
          {{ item.priceCu }}
        </td>
        <td
          pTooltip="{{ item.priorityTitle }}"
          tooltipEvent="hover"
          tooltipPosition="top">
          {{ item.priorityTitle }}
        </td>
        <td
          pTooltip="{{ item.weightTitle }}"
          tooltipEvent="hover"
          tooltipPosition="top">
          {{ item.weightTitle }}
        </td>
        <td
          pTooltip="{{ item.description }}"
          tooltipEvent="hover"
          tooltipPosition="top">
          {{ item.description }}
        </td>
        <td
          pTooltip="{{ item.statusTitle }}"
          tooltipEvent="hover"
          tooltipPosition="top">
          {{ item.statusTitle }}
        </td>
        <td class="jc-left ai-left">
          <button
            class="action-image-container delete-button"
            (click)="menu.toggle($event); setActiveComponentRoute(item)"
            pTooltip="">
            <img ngSrc="icons\Group 109.svg" width="24" height="24" />
          </button>
          <button
            class="action-image-container edit-button"
            (click)="editRow(item)"
            pTooltip="ویرایش">
            <img ngSrc="icons\Group 116.svg" width="24" height="24" />
          </button>

          <button
            class="action-image-container delete-button"
            (click)="deleteRow(item)"
            pTooltip="حذف">
            <img ngSrc="icons\Group 117.svg" width="24" height="24" />
          </button>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>

<p-dialog
  *ngIf="isOpenAddEditYearActivity"
  [header]="modalTitle"
  [(visible)]="isOpenAddEditYearActivity"
  [modal]="true"
  [draggable]="false"
  [resizable]="false"
  [style]="{ width: '900px' }"
  [class.height-size]="mode === 'insert' || mode === 'edit'">
  <PABudget-add-edit-year-activity
    [data1]="addEditData"
    [mode]="mode"
    (isSuccess)="reloadData()"></PABudget-add-edit-year-activity>
</p-dialog>

<p-confirmDialog [style]="{ width: '450px' }" [rtl]="true"></p-confirmDialog>

<p-menu
  [showTransitionOptions]="'0ms'"
  [hideTransitionOptions]="'0ms'"
  #menu
  [popup]="true"
  [model]="subComponentList"></p-menu>
